<!DOCTYPE html>

<html lang="zh-CN"  class="">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="keywords" content="">
    
    
    <meta name="description" content="">
    
    <meta name="generator" content="teedoc">
    <meta name="theme" content="teedoc-plugin-theme-default">
    
        
        <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        
        <script>
MathJax = {"loader": {"load": ["output/svg"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}, "svg": {"fontCache": "global"}};
</script>
        
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <script src="/lhfdoc.github.io/static/js/theme_default/pre_main.js"></script>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/theme_default/prism.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/theme_default/viewer.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/theme_default/dark.css" type="text/css"/>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/theme_default/light.css" type="text/css"/>
        
        <script src="/lhfdoc.github.io/static/js/theme_default/jquery.min.js"></script>
        
        <script src="/lhfdoc.github.io/static/js/theme_default/split.js"></script>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/search/style.css" type="text/css"/>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/custom.css" type="text/css"/>
        
    
    
    <title>OpenEarable 2.0 - 按键模块 (Buttons Module) - 7h4Worker</title>
    
    <script type="text/javascript">js_vars = {}</script>
    <script type="text/javascript">metadata = {"tags": [], "date": null, "update": [], "ts": 0, "author": "", "brief": "", "cover": ""}</script>
</head>


<body class="type_doc">
    
    <div id="navbar">
        <div id="navbar_menu">
            <a class="site_title" href="/lhfdoc.github.io/">
                
                
                    <h2>嵌入式开发</h2>
                
        </a>
            <a id="navbar_menu_btn"></a>
        </div>
        <div id="navbar_items">
            <div>
                <ul id="nav_left">
</ul>

            </div>
            <div>
                <ul id="nav_right">
</ul>

                <ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">搜索</span>
                            <div id="search_hints">
                                <span id="search_input_hint">输入关键词，多关键词空格隔开</span>
                                <span id="search_loading_hint">正在加载，请稍候。。。</span>
                                <span id="search_download_err_hint">下载文件失败，请刷新重试或检查网络</span>
                                <span id="search_other_docs_result_hint">来自其它文档的结果</span>
                                <span id="search_curr_doc_result_hint">当前文档搜索结果</span>
                            </div></a></li></ul>
            </div>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="sidebar_wrapper">
            <div id="sidebar">
                <div id="sidebar_title">
                    
                </div>
                <ul class="show">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/index.html"><span class="label">嵌入式开发</span><span class=""></span></a></li>
<li class="active_parent no_link"><a><span class="label">🎧 OpenEarable 2.0</span><span class="sub_indicator"></span></a><ul class="show">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/index.html"><span class="label">项目入门</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/project-overview.html"><span class="label">📋 项目概述</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/architecture.html"><span class="label">🏗️ 系统架构</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/deployment.html"><span class="label">🚀 部署指南</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/teedoc-guide.html"><span class="label">📖 teedoc使用指南</span><span class=""></span></a></li>
<li class="not_active no_link"><a><span class="label">核心功能模块</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/battery-module.html"><span class="label">🔋 电源管理模块</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/audio-module.html"><span class="label">🎵 音频处理模块</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/sensor-module.html"><span class="label">📡 传感器管理模块</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/bluetooth-module.html"><span class="label">📶 蓝牙通信模块</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/storage-module.html"><span class="label">💾 数据存储模块</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/drivers-module.html"><span class="label">🔧 硬件驱动模块</span><span class=""></span></a></li>
</ul>
</li>
<li class="active_parent no_link"><a><span class="label">辅助功能模块</span><span class="sub_indicator"></span></a><ul class="show">
<li class="active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/buttons-module.html"><span class="label">🎮 按键处理模块</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/parseinfo-module.html"><span class="label">📊 数据解析模块</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/wire-module.html"><span class="label">🔌 I2C通信模块</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/utils-module.html"><span class="label">🛠️ 系统工具模块</span><span class=""></span></a></li>
</ul>
</li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">💻 硬件平台</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=hardware_platforms/nordic.html&from=/embedded_dev/hardware_platforms/nordic.html"><span class="label">Nordic nRF系列</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=hardware_platforms/esp32.html&from=/embedded_dev/hardware_platforms/esp32.html"><span class="label">ESP32系列</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=hardware_platforms/stm32.html&from=/embedded_dev/hardware_platforms/stm32.html"><span class="label">STM32系列</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">⚙️ 实时操作系统</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=rtos/zephyr.html&from=/embedded_dev/rtos/zephyr.html"><span class="label">Zephyr RTOS</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=rtos/freertos.html&from=/embedded_dev/rtos/freertos.html"><span class="label">FreeRTOS</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=rtos/rtthread.html&from=/embedded_dev/rtos/rtthread.html"><span class="label">RT-Thread</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">🔗 通信协议</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=protocols/bluetooth.html&from=/embedded_dev/protocols/bluetooth.html"><span class="label">蓝牙协议</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=protocols/wifi.html&from=/embedded_dev/protocols/wifi.html"><span class="label">WiFi协议</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=protocols/lora.html&from=/embedded_dev/protocols/lora.html"><span class="label">LoRa/LoRaWAN</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">🛠️ 开发工具</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=tools/ide.html&from=/embedded_dev/tools/ide.html"><span class="label">IDE环境</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=tools/debug.html&from=/embedded_dev/tools/debug.html"><span class="label">调试工具</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=tools/simulation.html&from=/embedded_dev/tools/simulation.html"><span class="label">仿真平台</span><span class=""></span></a></li>
</ul>
</li>
</ul>

            </div>
        </div>
        <div id="article">
            <div id="menu_wrapper">
                <div id="menu">
                </div>
            </div>
            <div id="content_wrapper">
                <div id="content_body">
                    <div id="article_head">
                        <div id="article_title">
                            
                            <h1>OpenEarable 2.0 - 按键模块 (Buttons Module)</h1>
                            
                        </div>
                        <div id="article_tags">
                            <ul>
                            
                            </ul>
                        </div>
                        <div id="article_info">
                        <div id="article_info_left">
                            <span class="article_author">
                                
                            </span>
                            
                                <span class="article_date" title="最后修改日期： 2025-07-07">
                                    2025-07-07
                                </span>
                            
                        </div>
                        <div id="article_info_right">
                            
                        </div>
                        </div>
                    </div>
                    <div id="article_tools">
                        <span></span>
                        <span id="toc_btn"></span>
                    </div>
                    <div id="update_history">
                        
                    </div>
                    <div id="article_content">
                        
                            <h2 id="%E6%A6%82%E8%BF%B0">概述</h2>
<p>按键模块负责处理OpenEarable设备上的物理按键输入，包括按键事件检测、防抖处理、状态管理和事件分发。该模块为用户提供交互接口，支持播放/暂停、音量控制等功能。</p>
<h2 id="%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">核心组件</h2>
<h3 id="1.-Button-%E7%B1%BB-%28%3Ccode%3EButton.h/cpp%3C/code%3E%29">1. Button 类 (<code>Button.h/cpp</code>)</h3>
<p>主要的按键抽象类，处理单个按键的完整生命周期：</p>
<h4 id="%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3">核心接口</h4>

<pre class="language-cpp"><code class="language-cpp">class Button {
public:
    Button(gpio_dt_spec spec);
    void begin();                    // 初始化按键
    void end();                      // 清理按键资源
    button_action getState() const;  // 获取当前状态

private:
    k_work_delayable button_work;    // 延时工作队列
    const struct gpio_dt_spec button; // GPIO规格
    static struct gpio_callback button_cb_data; // 中断回调数据
    button_action _buttonState;      // 当前状态
    button_action _temp_buttonState; // 临时状态

    static void button_isr(const struct device *dev, struct gpio_callback *cb, uint32_t pins);
    int update_state();
    static void button_work_handler(struct k_work * work);
};
</code></pre>
<h4 id="%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86">状态管理</h4>
<ul>
<li><strong>BUTTON_RELEASED</strong>: 按键释放状态</li>
<li><strong>BUTTON_PRESS</strong>: 按键按下状态</li>
<li>使用防抖机制避免误触发</li>
</ul>
<h4 id="%E9%98%B2%E6%8A%96%E6%9C%BA%E5%88%B6">防抖机制</h4>

<pre class="language-cpp"><code class="language-cpp">#define BUTTON_DEBOUNCE K_MSEC(10)  // 10ms防抖延时
</code></pre>
<ul>
<li>中断触发时启动延时工作</li>
<li>延时结束后确认状态变化</li>
<li>状态未变化时取消延时工作</li>
</ul>
<h3 id="2.-%E6%8C%89%E9%94%AE%E7%AE%A1%E7%90%86%E5%99%A8-%28%3Ccode%3Ebutton_manager.h/c%3C/code%3E%29">2. 按键管理器 (<code>button_manager.h/c</code>)</h3>
<p>负责按键事件的消息队列管理和事件分发：</p>
<h4 id="%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97">消息队列</h4>

<pre class="language-c"><code class="language-c">K_MSGQ_DEFINE(button_queue, sizeof(struct button_msg), 1, 4);
</code></pre>
<h4 id="ZBus-%E9%80%9A%E9%81%93">ZBus 通道</h4>

<pre class="language-c"><code class="language-c">ZBUS_CHAN_DEFINE(button_chan, struct button_msg, NULL, NULL, ZBUS_OBSERVERS_EMPTY,
                 ZBUS_MSG_INIT(0));
</code></pre>
<h4 id="%E5%8F%91%E5%B8%83%E7%BA%BF%E7%A8%8B">发布线程</h4>

<pre class="language-c"><code class="language-c">void button_pub_task() {
    int ret;
    struct button_msg msg;

    while (1) {
        k_msgq_get(&amp;button_queue, &amp;msg, K_FOREVER);
        ret = zbus_chan_pub(&amp;button_chan, &amp;msg, K_FOREVER);
        if (ret) {
            LOG_ERR(&quot;Failed to publish button msg, ret: %d&quot;, ret);
        }
    }
}

K_THREAD_DEFINE(button_publish, CONFIG_BUTTON_PUBLISH_STACK_SIZE, button_pub_task, 
                NULL, NULL, NULL, K_PRIO_PREEMPT(CONFIG_BUTTON_PUBLISH_THREAD_PRIO), 0, 0);
</code></pre>
<h3 id="3.-%E6%8C%89%E9%94%AE%E5%88%86%E9%85%8D-%28%3Ccode%3Ebutton_assignments.h%3C/code%3E%29">3. 按键分配 (<code>button_assignments.h</code>)</h3>
<p>定义按键映射和枚举：</p>

<pre class="language-cpp"><code class="language-cpp">enum button_pin_names {
    BUTTON_EARABLE = DT_GPIO_PIN(DT_ALIAS(sw0), gpios),
    BUTTON_VOLUME_UP,       // 预留
    BUTTON_VOLUME_DOWN,     // 预留
    BUTTON_4,               // 预留
    BUTTON_5,               // 预留
};

#define BUTTON_PLAY_PAUSE BUTTON_EARABLE  // 别名定义
</code></pre>
<h3 id="4.-%E6%8C%89%E9%94%AE%E7%8A%B6%E6%80%81%E6%9F%A5%E8%AF%A2-%28%3Ccode%3Ebutton_pressed.cpp%3C/code%3E%29">4. 按键状态查询 (<code>button_pressed.cpp</code>)</h3>
<p>提供按键状态查询接口：</p>

<pre class="language-cpp"><code class="language-cpp">int button_pressed(enum button_pin_names pin, bool * pressed) {
    switch (pin) {
        case BUTTON_EARABLE:
            *pressed = (earable_btn.getState() == BUTTON_PRESS);
            return 0;
        default:
            *pressed = false;
            return 0;
    }
}
</code></pre>
<h2 id="%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">工作流程</h2>
<h3 id="1.-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B">1. 初始化流程</h3>

<pre class="language-none"><code class="language-none">Button构造 → GPIO配置 → 中断配置 → 回调注册 → 初始状态读取
</code></pre>
<h3 id="2.-%E6%8C%89%E9%94%AE%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B">2. 按键事件处理流程</h3>

<pre class="language-none"><code class="language-none">GPIO中断触发 → button_isr() → 启动延时工作 → button_work_handler() → 
update_state() → 消息入队 → button_pub_task() → ZBus发布
</code></pre>
<h3 id="3.-%E9%98%B2%E6%8A%96%E5%A4%84%E7%90%86">3. 防抖处理</h3>

<pre class="language-none"><code class="language-none">中断触发 → 读取临时状态 → 
如果状态相同 → 取消延时工作
如果状态不同 → 重新调度延时工作 → 延时后确认状态变化
</code></pre>
<h2 id="%E7%A1%AC%E4%BB%B6%E6%8E%A5%E5%8F%A3">硬件接口</h2>
<h3 id="GPIO-%E9%85%8D%E7%BD%AE">GPIO 配置</h3>
<ul>
<li>使用设备树别名 <code>sw0</code> 定义主按键</li>
<li>配置为输入模式 (<code>GPIO_INPUT</code>)</li>
<li>启用双边沿中断 (<code>GPIO_INT_EDGE_BOTH</code>)</li>
</ul>
<h3 id="%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86">中断处理</h3>
<ul>
<li>共享中断回调函数 <code>button_isr</code></li>
<li>支持多按键扩展（当前仅实现主按键）</li>
<li>中断安全的状态更新</li>
</ul>
<h2 id="%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9">配置选项</h2>
<h3 id="Kconfig-%E9%85%8D%E7%BD%AE">Kconfig 配置</h3>

<pre class="language-none"><code class="language-none">CONFIG_BUTTON_PUBLISH_STACK_SIZE    # 发布线程栈大小
CONFIG_BUTTON_PUBLISH_THREAD_PRIO   # 发布线程优先级
CONFIG_MODULE_BUTTON_HANDLER_LOG_LEVEL  # 日志级别
</code></pre>
<h3 id="%E8%AE%BE%E5%A4%87%E6%A0%91%E9%85%8D%E7%BD%AE">设备树配置</h3>

<pre class="language-dts"><code class="language-dts">aliases {
    sw0 = &amp;button0;  // 主按键别名
};
</code></pre>
<h2 id="%E6%89%A9%E5%B1%95%E6%80%A7%E8%AE%BE%E8%AE%A1">扩展性设计</h2>
<h3 id="%E5%A4%9A%E6%8C%89%E9%94%AE%E6%94%AF%E6%8C%81">多按键支持</h3>
<ul>
<li>代码中预留了多个按键的实现框架</li>
<li>可通过取消注释轻松添加音量按键等</li>
<li>支持不同按键的独立处理</li>
</ul>
<h3 id="%E6%8C%89%E9%94%AE%E5%8A%9F%E8%83%BD%E6%98%A0%E5%B0%84">按键功能映射</h3>
<ul>
<li>通过 <code>button_assignments.h</code> 集中管理按键功能</li>
<li>支持别名定义，便于功能重映射</li>
<li>可扩展复杂按键组合功能</li>
</ul>
<h2 id="%E9%9B%86%E6%88%90%E6%8E%A5%E5%8F%A3">集成接口</h2>
<h3 id="ZBus-%E6%B6%88%E6%81%AF">ZBus 消息</h3>

<pre class="language-cpp"><code class="language-cpp">struct button_msg {
    uint32_t button_pin;        // 按键引脚
    button_action button_action; // 按键动作
};
</code></pre>
<h3 id="%E8%AE%A2%E9%98%85%E8%80%85%E6%8E%A5%E5%8F%A3">订阅者接口</h3>
<p>其他模块可通过ZBus订阅按键事件：</p>

<pre class="language-c"><code class="language-c">ZBUS_SUBSCRIBER_DEFINE(button_sub, 1);
ZBUS_CHAN_ADD_OBS(button_chan, button_sub, 0);
</code></pre>
<h2 id="%E6%97%A5%E5%BF%97%E5%92%8C%E8%B0%83%E8%AF%95">日志和调试</h2>
<h3 id="%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97">日志模块</h3>

<pre class="language-c"><code class="language-c">LOG_MODULE_REGISTER(button, CONFIG_MODULE_BUTTON_HANDLER_LOG_LEVEL);
</code></pre>
<h3 id="%E5%85%B3%E9%94%AE%E6%97%A5%E5%BF%97%E7%82%B9">关键日志点</h3>
<ul>
<li>按键状态变化记录</li>
<li>消息队列满警告</li>
<li>GPIO配置错误</li>
<li>中断配置失败</li>
</ul>
<h2 id="%E5%8A%9F%E8%80%97%E4%BC%98%E5%8C%96">功耗优化</h2>
<h3 id="%E4%B8%AD%E6%96%AD%E9%A9%B1%E5%8A%A8">中断驱动</h3>
<ul>
<li>使用GPIO中断而非轮询</li>
<li>按键空闲时零功耗</li>
<li>中断唤醒系统</li>
</ul>
<h3 id="%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97%E4%BC%98%E5%8C%96">工作队列优化</h3>
<ul>
<li>使用延时工作队列进行防抖</li>
<li>避免持续CPU占用</li>
<li>适当的线程优先级配置</li>
</ul>
<h2 id="%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">错误处理</h2>
<h3 id="GPIO-%E9%94%99%E8%AF%AF">GPIO 错误</h3>
<ul>
<li>设备就绪检查</li>
<li>引脚配置失败处理</li>
<li>中断配置错误处理</li>
</ul>
<h3 id="%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%94%99%E8%AF%AF">消息队列错误</h3>
<ul>
<li>队列满时的警告日志</li>
<li>发布失败的错误处理</li>
<li>资源竞争保护</li>
</ul>
<h2 id="%E5%85%B8%E5%9E%8B%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">典型使用场景</h2>
<h3 id="1.-%E6%92%AD%E6%94%BE/%E6%9A%82%E5%81%9C%E6%8E%A7%E5%88%B6">1. 播放/暂停控制</h3>

<pre class="language-cpp"><code class="language-cpp">// 在音频模块中订阅按键事件
void audio_button_handler(const struct zbus_channel *chan) {
    struct button_msg msg;
    zbus_chan_read(chan, &amp;msg, K_FOREVER);

    if (msg.button_pin == BUTTON_EARABLE &amp;&amp; msg.button_action == BUTTON_PRESS) {
        // 执行播放/暂停逻辑
        toggle_playback();
    }
}
</code></pre>
<h3 id="2.-%E7%B3%BB%E7%BB%9F%E7%8A%B6%E6%80%81%E5%88%87%E6%8D%A2">2. 系统状态切换</h3>

<pre class="language-cpp"><code class="language-cpp">// 在状态管理模块中处理按键
void state_button_handler(const struct zbus_channel *chan) {
    struct button_msg msg;
    zbus_chan_read(chan, &amp;msg, K_FOREVER);

    if (msg.button_pin == BUTTON_EARABLE &amp;&amp; msg.button_action == BUTTON_PRESS) {
        // 状态切换或功能激活
        switch_system_state();
    }
}
</code></pre>
<h2 id="%E6%80%BB%E7%BB%93">总结</h2>
<p>按键模块提供了完整的物理按键交互支持，具有以下特点：</p>
<ol>
<li><strong>可靠性</strong>: 硬件防抖和软件状态确认</li>
<li><strong>扩展性</strong>: 支持多按键和复杂功能映射</li>
<li><strong>高效性</strong>: 中断驱动和事件发布机制</li>
<li><strong>集成性</strong>: 通过ZBus与其他模块无缝集成</li>
<li><strong>低功耗</strong>: 中断唤醒和适当的线程调度</li>
</ol>
<p>该模块为OpenEarable设备的用户交互提供了稳定可靠的基础设施。</p>

                        
                    </div>
                </div>
                <div id="previous_next">
                    <div id="previous">
                        
                        <a href="/lhfdoc.github.io/embedded_dev/openearable/drivers-module.html">
                            <span class="icon"></span>
                            <span class="label">🔧 硬件驱动模块</span>
                        </a>
                        
                    </div>
                    <div id="next">
                        
                        <a href="/lhfdoc.github.io/embedded_dev/openearable/parseinfo-module.html">
                            <span class="label">📊 数据解析模块</span>
                            <span class="icon"></span>
                        </a>
                        
                    </div>
                </div>
                <div id="comments-container"></div>
            </div>
            <div id="toc_wrapper">
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="to_top" href="#"></a>
    <div id="doc_footer">
        <div id="footer">
            <div id="footer_top">
                <ul>
<li><a>相关资源</a><ul><li><a target="_blank" href="https://www.nordicsemi.com/">Nordic官网</a></li>
<li><a target="_blank" href="https://zephyrproject.org/">Zephyr项目</a></li>
</ul>
</li>
</ul>

            </div>
            <div id="footer_bottom">
                <ul>
</ul>

            </div>
        </div>
    </div>
    
        <script src="/lhfdoc.github.io/teedoc-plugin-markdown-parser/mermaid.min.js"></script>
    
        <script>mermaid.initialize({startOnLoad:true});</script>
    
        <script src="/lhfdoc.github.io/static/js/theme_default/tocbot.min.js"></script>
    
        <script src="/lhfdoc.github.io/static/js/theme_default/main.js"></script>
    
        <script src="/lhfdoc.github.io/static/js/theme_default/viewer.min.js"></script>
    
        <script src="/lhfdoc.github.io/static/css/theme_default/prism.min.js"></script>
    
        <script src="/lhfdoc.github.io/static/js/search/search_main.js"></script>
    
        <script src="/lhfdoc.github.io/static/js/custom.js"></script>
    
</body>

</html>