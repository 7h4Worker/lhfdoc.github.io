<!DOCTYPE html>

<html lang="zh-CN"  class="">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="keywords" content="">
    
    
    <meta name="description" content="">
    
    <meta name="generator" content="teedoc">
    <meta name="theme" content="teedoc-plugin-theme-default">
    
        
        <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        
        <script>
MathJax = {"loader": {"load": ["output/svg"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}, "svg": {"fontCache": "global"}};
</script>
        
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <script src="/lhfdoc.github.io/static/js/theme_default/pre_main.js"></script>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/theme_default/prism.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/theme_default/viewer.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/theme_default/dark.css" type="text/css"/>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/theme_default/light.css" type="text/css"/>
        
        <script src="/lhfdoc.github.io/static/js/theme_default/jquery.min.js"></script>
        
        <script src="/lhfdoc.github.io/static/js/theme_default/split.js"></script>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/search/style.css" type="text/css"/>
        
        <link rel="stylesheet" href="/lhfdoc.github.io/static/css/custom.css" type="text/css"/>
        
    
    
    <title>ä¼ æ„Ÿå™¨ç®¡ç†æ¨¡å—è¯¦ç»†åˆ†æ - 7h4Worker</title>
    
    <script type="text/javascript">js_vars = {}</script>
    <script type="text/javascript">metadata = {"tags": [], "date": null, "update": [], "ts": 0, "author": "", "brief": "", "cover": ""}</script>
</head>


<body class="type_doc">
    
    <div id="navbar">
        <div id="navbar_menu">
            <a class="site_title" href="/lhfdoc.github.io/">
                
                
                    <h2>åµŒå…¥å¼å¼€å‘</h2>
                
        </a>
            <a id="navbar_menu_btn"></a>
        </div>
        <div id="navbar_items">
            <div>
                <ul id="nav_left">
</ul>

            </div>
            <div>
                <ul id="nav_right">
</ul>

                <ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">æœç´¢</span>
                            <div id="search_hints">
                                <span id="search_input_hint">è¾“å…¥å…³é”®è¯ï¼Œå¤šå…³é”®è¯ç©ºæ ¼éš”å¼€</span>
                                <span id="search_loading_hint">æ­£åœ¨åŠ è½½ï¼Œè¯·ç¨å€™ã€‚ã€‚ã€‚</span>
                                <span id="search_download_err_hint">ä¸‹è½½æ–‡ä»¶å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œ</span>
                                <span id="search_other_docs_result_hint">æ¥è‡ªå…¶å®ƒæ–‡æ¡£çš„ç»“æœ</span>
                                <span id="search_curr_doc_result_hint">å½“å‰æ–‡æ¡£æœç´¢ç»“æœ</span>
                            </div></a></li></ul>
            </div>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="sidebar_wrapper">
            <div id="sidebar">
                <div id="sidebar_title">
                    
                </div>
                <ul class="show">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/index.html"><span class="label">åµŒå…¥å¼å¼€å‘</span><span class=""></span></a></li>
<li class="active_parent no_link"><a><span class="label">ğŸ§ OpenEarable 2.0</span><span class="sub_indicator"></span></a><ul class="show">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/index.html"><span class="label">é¡¹ç›®å…¥é—¨</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/project-overview.html"><span class="label">ğŸ“‹ é¡¹ç›®æ¦‚è¿°</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/architecture.html"><span class="label">ğŸ—ï¸ ç³»ç»Ÿæ¶æ„</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/deployment.html"><span class="label">ğŸš€ éƒ¨ç½²æŒ‡å—</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/teedoc-guide.html"><span class="label">ğŸ“– teedocä½¿ç”¨æŒ‡å—</span><span class=""></span></a></li>
<li class="active_parent no_link"><a><span class="label">æ ¸å¿ƒåŠŸèƒ½æ¨¡å—</span><span class="sub_indicator"></span></a><ul class="show">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/battery-module.html"><span class="label">ğŸ”‹ ç”µæºç®¡ç†æ¨¡å—</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/audio-module.html"><span class="label">ğŸµ éŸ³é¢‘å¤„ç†æ¨¡å—</span><span class=""></span></a></li>
<li class="active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/sensor-module.html"><span class="label">ğŸ“¡ ä¼ æ„Ÿå™¨ç®¡ç†æ¨¡å—</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/bluetooth-module.html"><span class="label">ğŸ“¶ è“ç‰™é€šä¿¡æ¨¡å—</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/storage-module.html"><span class="label">ğŸ’¾ æ•°æ®å­˜å‚¨æ¨¡å—</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/drivers-module.html"><span class="label">ğŸ”§ ç¡¬ä»¶é©±åŠ¨æ¨¡å—</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">è¾…åŠ©åŠŸèƒ½æ¨¡å—</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/buttons-module.html"><span class="label">ğŸ® æŒ‰é”®å¤„ç†æ¨¡å—</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/parseinfo-module.html"><span class="label">ğŸ“Š æ•°æ®è§£ææ¨¡å—</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/wire-module.html"><span class="label">ğŸ”Œ I2Cé€šä¿¡æ¨¡å—</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/openearable/utils-module.html"><span class="label">ğŸ› ï¸ ç³»ç»Ÿå·¥å…·æ¨¡å—</span><span class=""></span></a></li>
</ul>
</li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">ğŸ’» ç¡¬ä»¶å¹³å°</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=hardware_platforms/nordic.html&from=/embedded_dev/hardware_platforms/nordic.html"><span class="label">Nordic nRFç³»åˆ—</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=hardware_platforms/esp32.html&from=/embedded_dev/hardware_platforms/esp32.html"><span class="label">ESP32ç³»åˆ—</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=hardware_platforms/stm32.html&from=/embedded_dev/hardware_platforms/stm32.html"><span class="label">STM32ç³»åˆ—</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">âš™ï¸ å®æ—¶æ“ä½œç³»ç»Ÿ</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=rtos/zephyr.html&from=/embedded_dev/rtos/zephyr.html"><span class="label">Zephyr RTOS</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=rtos/freertos.html&from=/embedded_dev/rtos/freertos.html"><span class="label">FreeRTOS</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=rtos/rtthread.html&from=/embedded_dev/rtos/rtthread.html"><span class="label">RT-Thread</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">ğŸ”— é€šä¿¡åè®®</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=protocols/bluetooth.html&from=/embedded_dev/protocols/bluetooth.html"><span class="label">è“ç‰™åè®®</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=protocols/wifi.html&from=/embedded_dev/protocols/wifi.html"><span class="label">WiFiåè®®</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=protocols/lora.html&from=/embedded_dev/protocols/lora.html"><span class="label">LoRa/LoRaWAN</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">ğŸ› ï¸ å¼€å‘å·¥å…·</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=tools/ide.html&from=/embedded_dev/tools/ide.html"><span class="label">IDEç¯å¢ƒ</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=tools/debug.html&from=/embedded_dev/tools/debug.html"><span class="label">è°ƒè¯•å·¥å…·</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/lhfdoc.github.io/embedded_dev/no_translate.html?ref=tools/simulation.html&from=/embedded_dev/tools/simulation.html"><span class="label">ä»¿çœŸå¹³å°</span><span class=""></span></a></li>
</ul>
</li>
</ul>

            </div>
        </div>
        <div id="article">
            <div id="menu_wrapper">
                <div id="menu">
                </div>
            </div>
            <div id="content_wrapper">
                <div id="content_body">
                    <div id="article_head">
                        <div id="article_title">
                            
                            <h1>ä¼ æ„Ÿå™¨ç®¡ç†æ¨¡å—è¯¦ç»†åˆ†æ</h1>
                            
                        </div>
                        <div id="article_tags">
                            <ul>
                            
                            </ul>
                        </div>
                        <div id="article_info">
                        <div id="article_info_left">
                            <span class="article_author">
                                
                            </span>
                            
                                <span class="article_date" title="æœ€åä¿®æ”¹æ—¥æœŸï¼š 2025-07-07">
                                    2025-07-07
                                </span>
                            
                        </div>
                        <div id="article_info_right">
                            
                        </div>
                        </div>
                    </div>
                    <div id="article_tools">
                        <span></span>
                        <span id="toc_btn"></span>
                    </div>
                    <div id="update_history">
                        
                    </div>
                    <div id="article_content">
                        
                            <h2 id="%E6%A8%A1%E5%9D%97%E6%A6%82%E8%BF%B0">æ¨¡å—æ¦‚è¿°</h2>
<p>ä¼ æ„Ÿå™¨ç®¡ç†æ¨¡å—æ˜¯OpenEarable 2.0çš„æ ¸å¿ƒåˆ›æ–°ç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†é›†æˆçš„å¤šç§é«˜ç²¾åº¦ä¼ æ„Ÿå™¨ï¼ŒåŒ…æ‹¬IMUã€PPGã€æ¸©åº¦ã€æ°”å‹ã€éº¦å…‹é£ç­‰ä¼ æ„Ÿå™¨ã€‚è¯¥æ¨¡å—æä¾›ç»Ÿä¸€çš„ä¼ æ„Ÿå™¨æ¥å£ã€æ•°æ®é‡‡é›†ã€å¤„ç†å’Œä¼ è¾“åŠŸèƒ½ï¼Œæ˜¯OpenEarableåŒºåˆ«äºæ™®é€šéŸ³é¢‘è®¾å¤‡çš„å…³é”®ç‰¹æ€§ã€‚</p>
<h2 id="%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">æ–‡ä»¶ç»“æ„</h2>

<pre class="language-none"><code class="language-none">src/SensorManager/
â”œâ”€â”€ SensorManager.h/.cpp      # ä¼ æ„Ÿå™¨ç®¡ç†å™¨æ ¸å¿ƒ
â”œâ”€â”€ EdgeMLSensor.h/.cpp       # ä¼ æ„Ÿå™¨åŸºç±»å®šä¹‰
â”œâ”€â”€ IMU.h/.cpp               # æƒ¯æ€§æµ‹é‡å•å…ƒä¼ æ„Ÿå™¨
â”œâ”€â”€ PPG.h/.cpp               # å…‰ç”µå®¹ç§¯è„‰ææ³¢ä¼ æ„Ÿå™¨
â”œâ”€â”€ Baro.h/.cpp              # æ°”å‹ä¼ æ„Ÿå™¨
â”œâ”€â”€ Temp.h/.cpp              # æ¸©åº¦ä¼ æ„Ÿå™¨
â”œâ”€â”€ BoneConduction.h/.cpp    # éª¨ä¼ å¯¼ä¼ æ„Ÿå™¨
â”œâ”€â”€ Microphone.h/.cpp        # éº¦å…‹é£ä¼ æ„Ÿå™¨
â”œâ”€â”€ BMX160/                  # BMX160 IMUé©±åŠ¨
â”œâ”€â”€ MAXM86161/              # MAXM86161 PPGé©±åŠ¨
â”œâ”€â”€ BMP388/                 # BMP388 æ°”å‹è®¡é©±åŠ¨
â”œâ”€â”€ MLX90632/               # MLX90632 çº¢å¤–æ¸©åº¦è®¡é©±åŠ¨
â”œâ”€â”€ BMA580/                 # BMA580 åŠ é€Ÿåº¦è®¡é©±åŠ¨
â”œâ”€â”€ CMakeLists.txt          # æ„å»ºé…ç½®
â””â”€â”€ Kconfig                 # é…ç½®é€‰é¡¹
</code></pre>
<h2 id="%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84">æ ¸å¿ƒæ¶æ„</h2>
<h3 id="1.-SensorManager---%E4%BC%A0%E6%84%9F%E5%99%A8%E7%AE%A1%E7%90%86%E5%99%A8">1. SensorManager - ä¼ æ„Ÿå™¨ç®¡ç†å™¨</h3>
<p>SensorManageræ˜¯æ•´ä¸ªä¼ æ„Ÿå™¨ç³»ç»Ÿçš„æ ¸å¿ƒæ§åˆ¶ç»„ä»¶ï¼Œè´Ÿè´£ä¼ æ„Ÿå™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€æ•°æ®æµæ§åˆ¶å’Œç³»ç»Ÿåè°ƒã€‚</p>
<h4 id="%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD">ä¸»è¦åŠŸèƒ½</h4>
<ul>
<li><strong>ä¼ æ„Ÿå™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>: åˆå§‹åŒ–ã€å¯åŠ¨ã€åœæ­¢ä¼ æ„Ÿå™¨</li>
<li><strong>æ•°æ®æµç®¡ç†</strong>: ä¼ æ„Ÿå™¨æ•°æ®çš„é‡‡é›†ã€ç¼“å†²å’Œåˆ†å‘</li>
<li><strong>é…ç½®ç®¡ç†</strong>: åŠ¨æ€é…ç½®ä¼ æ„Ÿå™¨å‚æ•°</li>
<li><strong>æ¶ˆæ¯æ€»çº¿é›†æˆ</strong>: é€šè¿‡ZBusä¸å…¶ä»–æ¨¡å—é€šä¿¡</li>
<li><strong>å­˜å‚¨ç®¡ç†</strong>: æ§åˆ¶æ•°æ®çš„æœ¬åœ°å­˜å‚¨å’Œè“ç‰™ä¼ è¾“</li>
</ul>
<h4 id="%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3">æ ¸å¿ƒæ¥å£</h4>

<pre class="language-cpp"><code class="language-cpp">// ä¼ æ„Ÿå™¨ç®¡ç†å™¨çŠ¶æ€
enum sensor_manager_state {
    INIT,           // åˆå§‹åŒ–çŠ¶æ€
    RUNNING,        // è¿è¡ŒçŠ¶æ€
    SUSPENDED,      // æŒ‚èµ·çŠ¶æ€
};

// ä¸»è¦æ§åˆ¶æ¥å£
void init_sensor_manager();                        // åˆå§‹åŒ–ä¼ æ„Ÿå™¨ç®¡ç†å™¨
void start_sensor_manager();                       // å¯åŠ¨ä¼ æ„Ÿå™¨ç®¡ç†å™¨
void stop_sensor_manager();                        // åœæ­¢ä¼ æ„Ÿå™¨ç®¡ç†å™¨
void config_sensor(struct sensor_config *config);  // é…ç½®ä¼ æ„Ÿå™¨
enum sensor_manager_state get_state();             // è·å–ç®¡ç†å™¨çŠ¶æ€
</code></pre>
<h4 id="%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97%E6%9E%B6%E6%9E%84">å·¥ä½œé˜Ÿåˆ—æ¶æ„</h4>

<pre class="language-cpp"><code class="language-cpp">// ä¼ æ„Ÿå™¨ä¸“ç”¨å·¥ä½œé˜Ÿåˆ—
extern struct k_work_q sensor_work_q;

// æ¶ˆæ¯é˜Ÿåˆ—å®šä¹‰
K_MSGQ_DEFINE(sensor_queue, sizeof(struct sensor_msg), 256, 4);
K_MSGQ_DEFINE(config_queue, sizeof(struct sensor_config), 16, 4);

// ZBusé€šé“å®šä¹‰
ZBUS_CHAN_DEFINE(sensor_chan, struct sensor_msg, NULL, NULL, 
                 ZBUS_OBSERVERS_EMPTY, ZBUS_MSG_INIT(0));
</code></pre>
<h3 id="2.-EdgeMLSensor---%E4%BC%A0%E6%84%9F%E5%99%A8%E5%9F%BA%E7%B1%BB">2. EdgeMLSensor - ä¼ æ„Ÿå™¨åŸºç±»</h3>
<p>EdgeMLSensoræ˜¯æ‰€æœ‰ä¼ æ„Ÿå™¨ç±»çš„æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰äº†ç»Ÿä¸€çš„ä¼ æ„Ÿå™¨æ¥å£å’Œè¡Œä¸ºæ¨¡å¼ã€‚</p>
<h4 id="%E8%AE%BE%E8%AE%A1%E7%89%B9%E7%82%B9">è®¾è®¡ç‰¹ç‚¹</h4>
<ul>
<li><strong>çº¯è™šå‡½æ•°æ¥å£</strong>: å¼ºåˆ¶å­ç±»å®ç°æ ¸å¿ƒåŠŸèƒ½</li>
<li><strong>ç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸ</strong>: æ ‡å‡†åŒ–çš„åˆå§‹åŒ–ã€å¯åŠ¨ã€åœæ­¢æµç¨‹</li>
<li><strong>é…ç½®åŒ–é‡‡æ ·ç‡</strong>: æ”¯æŒå¤šæ¡£ä½é‡‡æ ·ç‡é…ç½®</li>
<li><strong>åŒé‡æ•°æ®æµ</strong>: æ”¯æŒSDå¡å­˜å‚¨å’Œè“ç‰™ä¼ è¾“</li>
</ul>
<h4 id="%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3">æ ¸å¿ƒæ¥å£</h4>

<pre class="language-cpp"><code class="language-cpp">template &lt;size_t N&gt;
struct SampleRateSetting {
    uint8_t reg_vals[N];        // å¯„å­˜å™¨é…ç½®å€¼
    float sample_rates[N];      // æ ‡ç§°é‡‡æ ·ç‡
    float true_sample_rates[N]; // å®é™…é‡‡æ ·ç‡
};

class EdgeMlSensor {
public:
    // çº¯è™šå‡½æ•°æ¥å£
    virtual bool init(struct k_msgq *queue) = 0;   // åˆå§‹åŒ–ä¼ æ„Ÿå™¨
    virtual void start(int sample_rate_idx) = 0;   // å¯åŠ¨ä¼ æ„Ÿå™¨
    virtual void stop() = 0;                       // åœæ­¢ä¼ æ„Ÿå™¨

    // çŠ¶æ€æŸ¥è¯¢å’Œæ§åˆ¶
    bool is_running();                             // æ£€æŸ¥è¿è¡ŒçŠ¶æ€
    void sd_logging(bool enable);                  // æ§åˆ¶SDå¡è®°å½•
    void ble_stream(bool enable);                  // æ§åˆ¶è“ç‰™æµä¼ è¾“

protected:
    k_work sensor_work;         // ä¼ æ„Ÿå™¨å·¥ä½œé¡¹
    k_timer sensor_timer;       // ä¼ æ„Ÿå™¨å®šæ—¶å™¨
    static k_msgq *sensor_queue; // ä¼ æ„Ÿå™¨æ¶ˆæ¯é˜Ÿåˆ—

    bool _sd_logging = false;   // SDå¡è®°å½•æ ‡å¿—
    bool _ble_stream = true;    // è“ç‰™ä¼ è¾“æ ‡å¿—
    bool _running = false;      // è¿è¡ŒçŠ¶æ€æ ‡å¿—
};
</code></pre>
<h2 id="%E4%BC%A0%E6%84%9F%E5%99%A8%E5%AE%9E%E7%8E%B0%E8%AF%A6%E8%A7%A3">ä¼ æ„Ÿå™¨å®ç°è¯¦è§£</h2>
<h3 id="1.-IMU-%E4%BC%A0%E6%84%9F%E5%99%A8-%28BMX160%29">1. IMU ä¼ æ„Ÿå™¨ (BMX160)</h3>
<p>IMUä¼ æ„Ÿå™¨åŸºäºBosch BMX160ä¹è½´ä¼ æ„Ÿå™¨ï¼Œæä¾›åŠ é€Ÿåº¦è®¡ã€é™€èºä»ªå’Œç£åŠ›è®¡æ•°æ®ã€‚</p>
<h4 id="%E6%8A%80%E6%9C%AF%E8%A7%84%E6%A0%BC">æŠ€æœ¯è§„æ ¼</h4>
<ul>
<li><strong>åŠ é€Ÿåº¦è®¡</strong>: Â±2g/Â±4g/Â±8g/Â±16gé‡ç¨‹ï¼Œ14ä½åˆ†è¾¨ç‡</li>
<li><strong>é™€èºä»ª</strong>: Â±125Â°/såˆ°Â±2000Â°/sé‡ç¨‹ï¼Œ16ä½åˆ†è¾¨ç‡</li>
<li><strong>ç£åŠ›è®¡</strong>: Â±1300Î¼Té‡ç¨‹ï¼Œé«˜ç²¾åº¦ç£åœºæµ‹é‡</li>
</ul>
<h4 id="%E9%87%87%E6%A0%B7%E7%8E%87%E9%85%8D%E7%BD%AE">é‡‡æ ·ç‡é…ç½®</h4>

<pre class="language-cpp"><code class="language-cpp">class IMU : public EdgeMlSensor {
public:
    const static SampleRateSetting&lt;6&gt; sample_rates;

private:
    static DFRobot_BMX160 imu;  // BMX160é©±åŠ¨å®ä¾‹
};

// æ”¯æŒçš„é‡‡æ ·ç‡è®¾ç½®
const SampleRateSetting&lt;6&gt; IMU::sample_rates = {
    .reg_vals = {0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C},
    .sample_rates = {25.0, 50.0, 100.0, 200.0, 400.0, 800.0},
    .true_sample_rates = {25.32, 50.64, 101.28, 202.56, 405.12, 810.24}
};
</code></pre>
<h4 id="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">æ•°æ®ç»“æ„</h4>

<pre class="language-cpp"><code class="language-cpp">struct imu_data {
    float accel_x, accel_y, accel_z;    // åŠ é€Ÿåº¦ (m/sÂ²)
    float gyro_x, gyro_y, gyro_z;       // è§’é€Ÿåº¦ (rad/s)
    float mag_x, mag_y, mag_z;          // ç£åœºå¼ºåº¦ (Î¼T)
    uint64_t timestamp;                 // æ—¶é—´æˆ³ (Î¼s)
} __attribute__((packed));
</code></pre>
<h3 id="2.-PPG-%E4%BC%A0%E6%84%9F%E5%99%A8-%28MAXM86161%29">2. PPG ä¼ æ„Ÿå™¨ (MAXM86161)</h3>
<p>PPGä¼ æ„Ÿå™¨åŸºäºMaxim MAXM86161å…‰å­¦ä¼ æ„Ÿå™¨ï¼Œç”¨äºå¿ƒç‡ç›‘æµ‹ã€è¡€æ°§æµ‹é‡å’Œç”Ÿç†ä¿¡å·åˆ†æã€‚</p>
<h4 id="%E6%8A%80%E6%9C%AF%E8%A7%84%E6%A0%BC">æŠ€æœ¯è§„æ ¼</h4>
<ul>
<li><strong>å…‰æº</strong>: çº¢å…‰ã€çº¢å¤–å…‰ã€ç»¿å…‰LED</li>
<li><strong>å…‰ç”µäºŒæç®¡</strong>: é«˜çµæ•åº¦å…‰ç”µæ£€æµ‹å™¨</li>
<li><strong>é‡‡æ ·ç‡</strong>: æœ€é«˜3200Hz</li>
<li><strong>åˆ†è¾¨ç‡</strong>: 19ä½ADC</li>
</ul>
<h4 id="LED%E9%85%8D%E7%BD%AE">LEDé…ç½®</h4>

<pre class="language-cpp"><code class="language-cpp">enum led_order {
    red,        // çº¢å…‰LED (660nm)
    green,      // ç»¿å…‰LED (537nm) 
    ir,         // çº¢å¤–LED (880nm)
    ambient     // ç¯å¢ƒå…‰æ£€æµ‹
};

class PPG : public EdgeMlSensor {
public:
    const static SampleRateSetting&lt;16&gt; sample_rates;

private:
    static MAXM86161 ppg;           // MAXM86161é©±åŠ¨å®ä¾‹
    ppg_sample data_buffer[64];     // æ•°æ®ç¼“å†²åŒº
};
</code></pre>
<h4 id="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">æ•°æ®ç»“æ„</h4>

<pre class="language-cpp"><code class="language-cpp">struct ppg_sample {
    uint32_t red;           // çº¢å…‰é€šé“æ•°æ®
    uint32_t ir;            // çº¢å¤–é€šé“æ•°æ®
    uint32_t green;         // ç»¿å…‰é€šé“æ•°æ®
    uint32_t ambient;       // ç¯å¢ƒå…‰æ•°æ®
    uint64_t timestamp;     // æ—¶é—´æˆ³
} __attribute__((packed));
</code></pre>
<h3 id="3.-%E6%B8%A9%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8-%28MLX90632%29">3. æ¸©åº¦ä¼ æ„Ÿå™¨ (MLX90632)</h3>
<p>æ¸©åº¦ä¼ æ„Ÿå™¨åŸºäºMelexis MLX90632éæ¥è§¦å¼çº¢å¤–æ¸©åº¦è®¡ï¼Œå¯æµ‹é‡ç‰©ä½“æ¸©åº¦å’Œç¯å¢ƒæ¸©åº¦ã€‚</p>
<h4 id="%E6%8A%80%E6%9C%AF%E8%A7%84%E6%A0%BC">æŠ€æœ¯è§„æ ¼</h4>
<ul>
<li><strong>æµ‹é‡èŒƒå›´</strong>: -20Â°Cåˆ°85Â°C (ç¯å¢ƒ), -20Â°Cåˆ°200Â°C (ç‰©ä½“)</li>
<li><strong>ç²¾åº¦</strong>: Â±0.2Â°C (å…¸å‹å€¼)</li>
<li><strong>å“åº”æ—¶é—´</strong>: &lt;1ç§’</li>
<li><strong>æ¥å£</strong>: I2C</li>
</ul>
<h4 id="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">æ•°æ®ç»“æ„</h4>

<pre class="language-cpp"><code class="language-cpp">struct temp_data {
    float ambient_temp;     // ç¯å¢ƒæ¸©åº¦ (Â°C)
    float object_temp;      // ç‰©ä½“æ¸©åº¦ (Â°C)
    uint64_t timestamp;     // æ—¶é—´æˆ³
} __attribute__((packed));
</code></pre>
<h3 id="4.-%E6%B0%94%E5%8E%8B%E4%BC%A0%E6%84%9F%E5%99%A8-%28BMP388%29">4. æ°”å‹ä¼ æ„Ÿå™¨ (BMP388)</h3>
<p>æ°”å‹ä¼ æ„Ÿå™¨åŸºäºBosch BMP388é«˜ç²¾åº¦æ°”å‹è®¡ï¼Œç”¨äºé«˜åº¦æµ‹é‡å’Œç¯å¢ƒç›‘æµ‹ã€‚</p>
<h4 id="%E6%8A%80%E6%9C%AF%E8%A7%84%E6%A0%BC">æŠ€æœ¯è§„æ ¼</h4>
<ul>
<li><strong>å‹åŠ›èŒƒå›´</strong>: 300-1250 hPa</li>
<li><strong>ç²¾åº¦</strong>: Â±0.08 hPa (å…¸å‹å€¼)</li>
<li><strong>é«˜åº¦åˆ†è¾¨ç‡</strong>: Â±8 cm</li>
<li><strong>æ¸©åº¦è¡¥å¿</strong>: é›†æˆæ¸©åº¦ä¼ æ„Ÿå™¨</li>
</ul>
<h4 id="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">æ•°æ®ç»“æ„</h4>

<pre class="language-cpp"><code class="language-cpp">struct baro_data {
    float pressure;         // å¤§æ°”å‹åŠ› (hPa)
    float temperature;      // æ¸©åº¦ (Â°C)
    float altitude;         // æµ·æ‹”é«˜åº¦ (m)
    uint64_t timestamp;     // æ—¶é—´æˆ³
} __attribute__((packed));
</code></pre>
<h3 id="5.-%E9%AA%A8%E4%BC%A0%E5%AF%BC%E4%BC%A0%E6%84%9F%E5%99%A8">5. éª¨ä¼ å¯¼ä¼ æ„Ÿå™¨</h3>
<p>éª¨ä¼ å¯¼ä¼ æ„Ÿå™¨é€šè¿‡æ£€æµ‹é¢…éª¨æŒ¯åŠ¨æ¥æ„ŸçŸ¥è¯­éŸ³å’Œå’€åš¼ç­‰ç”Ÿç†æ´»åŠ¨ã€‚</p>
<h4 id="%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">å®ç°åŸç†</h4>
<ul>
<li><strong>æŒ¯åŠ¨æ£€æµ‹</strong>: é«˜çµæ•åº¦åŠ é€Ÿåº¦è®¡æ£€æµ‹éª¨ä¼ å¯¼æŒ¯åŠ¨</li>
<li><strong>ä¿¡å·å¤„ç†</strong>: æ•°å­—æ»¤æ³¢å’Œç‰¹å¾æå–</li>
<li><strong>æ¨¡å¼è¯†åˆ«</strong>: è¯­éŸ³æ´»åŠ¨æ£€æµ‹(VAD)</li>
</ul>
<h4 id="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">æ•°æ®ç»“æ„</h4>

<pre class="language-cpp"><code class="language-cpp">struct bone_conduction_data {
    float vibration_x, vibration_y, vibration_z;   // ä¸‰è½´æŒ¯åŠ¨æ•°æ®
    float rms_amplitude;                           // RMSæŒ¯å¹…
    bool voice_activity;                           // è¯­éŸ³æ´»åŠ¨æ ‡å¿—
    uint64_t timestamp;                            // æ—¶é—´æˆ³
} __attribute__((packed));
</code></pre>
<h2 id="%E6%95%B0%E6%8D%AE%E6%B5%81%E6%9E%B6%E6%9E%84">æ•°æ®æµæ¶æ„</h2>
<h3 id="%E4%BC%A0%E6%84%9F%E5%99%A8%E6%95%B0%E6%8D%AE%E6%B5%81">ä¼ æ„Ÿå™¨æ•°æ®æµ</h3>

<pre class="language-none"><code class="language-none">[ä¼ æ„Ÿå™¨ç¡¬ä»¶] â†’ [é©±åŠ¨å±‚] â†’ [EdgeMLSensor] â†’ [SensorManager] â†’ [æ•°æ®åˆ†å‘]
                                                                    â†“
                                                              [SDå¡å­˜å‚¨]
                                                                    â†“
                                                              [è“ç‰™ä¼ è¾“]
</code></pre>
<h3 id="%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%B3%BB%E7%BB%9F">æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ</h3>

<pre class="language-cpp"><code class="language-cpp">// ä¼ æ„Ÿå™¨æ¶ˆæ¯ç»“æ„
struct sensor_msg {
    bool sd;                    // SDå¡å­˜å‚¨æ ‡å¿—
    bool stream;                // è“ç‰™ä¼ è¾“æ ‡å¿—
    struct sensor_data data;    // ä¼ æ„Ÿå™¨æ•°æ®
};

// ä¼ æ„Ÿå™¨æ•°æ®ç»“æ„
struct sensor_data {
    uint8_t id;                 // ä¼ æ„Ÿå™¨ID
    uint8_t size;               // æ•°æ®å¤§å°
    uint64_t time;              // æ—¶é—´æˆ³
    uint8_t data[36];           // æ•°æ®è½½è·
} __attribute__((packed));
</code></pre>
<h3 id="%E9%85%8D%E7%BD%AE%E7%B3%BB%E7%BB%9F">é…ç½®ç³»ç»Ÿ</h3>

<pre class="language-cpp"><code class="language-cpp">// ä¼ æ„Ÿå™¨é…ç½®ç»“æ„
struct sensor_config {
    uint8_t sensorId;           // ä¼ æ„Ÿå™¨ID
    uint8_t sampleRateIndex;    // é‡‡æ ·ç‡ç´¢å¼•
    uint8_t storageOptions;     // å­˜å‚¨é€‰é¡¹
} __attribute__((packed));

// ä¼ æ„Ÿå™¨IDæšä¸¾
enum sensor_id {
    ID_IMU = 0,                 // æƒ¯æ€§æµ‹é‡å•å…ƒ
    ID_TEMP_BARO = 1,           // æ¸©åº¦æ°”å‹ä¼ æ„Ÿå™¨
    ID_MICRO = 2,               // éº¦å…‹é£
    ID_PPG = 4,                 // å…‰ç”µå®¹ç§¯è„‰ææ³¢
    ID_PULSOX = 5,              // è„‰æè¡€æ°§
    ID_OPTTEMP = 6,             // å…‰å­¦æ¸©åº¦è®¡
    ID_BONE_CONDUCTION = 7,     // éª¨ä¼ å¯¼ä¼ æ„Ÿå™¨
};
</code></pre>
<h2 id="%E5%AE%9A%E6%97%B6%E5%99%A8%E5%92%8C%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F">å®šæ—¶å™¨å’Œä¸­æ–­ç³»ç»Ÿ</h2>
<h3 id="%E5%AE%9A%E6%97%B6%E5%99%A8%E9%A9%B1%E5%8A%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86">å®šæ—¶å™¨é©±åŠ¨çš„æ•°æ®é‡‡é›†</h3>

<pre class="language-cpp"><code class="language-cpp">class IMU : public EdgeMlSensor {
private:
    // å®šæ—¶å™¨ä¸­æ–­å¤„ç†å‡½æ•°
    static void sensor_timer_handler(struct k_timer *dummy) {
        k_work_submit_to_queue(&amp;sensor_work_q, &amp;sensor.sensor_work);
    }

    // ä¼ æ„Ÿå™¨æ•°æ®æ›´æ–°å·¥ä½œé¡¹
    static void update_sensor(struct k_work *work) {
        // 1. è¯»å–ä¼ æ„Ÿå™¨æ•°æ®
        bmx160_data_t raw_data;
        imu.read_sensor_data(&amp;raw_data);

        // 2. æ•°æ®æ ¼å¼è½¬æ¢
        struct sensor_data sensor_data;
        format_imu_data(&amp;raw_data, &amp;sensor_data);

        // 3. å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—
        struct sensor_msg msg = {
            .sd = sensor._sd_logging,
            .stream = sensor._ble_stream,
            .data = sensor_data
        };
        k_msgq_put(&amp;sensor_queue, &amp;msg, K_NO_WAIT);
    }
};
</code></pre>
<h3 id="%E4%B8%AD%E6%96%AD%E9%A9%B1%E5%8A%A8%E7%9A%84%E4%BA%8B%E4%BB%B6%E6%A3%80%E6%B5%8B">ä¸­æ–­é©±åŠ¨çš„äº‹ä»¶æ£€æµ‹</h3>

<pre class="language-cpp"><code class="language-cpp">// PPGä¼ æ„Ÿå™¨çš„FIFOä¸­æ–­å¤„ç†
void ppg_fifo_interrupt_handler() {
    // 1. è¯»å–FIFOæ•°æ®
    uint8_t fifo_samples = ppg.get_fifo_samples();

    for (int i = 0; i &lt; fifo_samples; i++) {
        // 2. å¤„ç†æ¯ä¸ªæ ·æœ¬
        ppg_sample sample;
        ppg.read_fifo_sample(&amp;sample);

        // 3. è´¨é‡æ£€æŸ¥å’Œå¤„ç†
        if (is_valid_ppg_sample(&amp;sample)) {
            process_ppg_data(&amp;sample);
        }
    }
}
</code></pre>
<h2 id="%E5%8A%9F%E8%80%97%E7%AE%A1%E7%90%86">åŠŸè€—ç®¡ç†</h2>
<h3 id="%E5%8A%A8%E6%80%81%E5%8A%9F%E8%80%97%E6%8E%A7%E5%88%B6">åŠ¨æ€åŠŸè€—æ§åˆ¶</h3>

<pre class="language-cpp"><code class="language-cpp">void sensor_power_management() {
    // æ ¹æ®æ´»è·ƒä¼ æ„Ÿå™¨æ•°é‡è°ƒæ•´åŠŸè€—
    if (active_sensors == 0) {
        // æ— æ´»è·ƒä¼ æ„Ÿå™¨ï¼Œè¿›å…¥ä½åŠŸè€—æ¨¡å¼
        set_sensor_power_mode(POWER_MODE_SLEEP);
    } else if (active_sensors &lt;= 2) {
        // å°‘é‡ä¼ æ„Ÿå™¨ï¼Œä¸­ç­‰åŠŸè€—æ¨¡å¼
        set_sensor_power_mode(POWER_MODE_NORMAL);
    } else {
        // å¤šä¼ æ„Ÿå™¨ï¼Œé«˜æ€§èƒ½æ¨¡å¼
        set_sensor_power_mode(POWER_MODE_HIGH_PERFORMANCE);
    }
}
</code></pre>
<h3 id="%E9%87%87%E6%A0%B7%E7%8E%87%E8%87%AA%E9%80%82%E5%BA%94">é‡‡æ ·ç‡è‡ªé€‚åº”</h3>

<pre class="language-cpp"><code class="language-cpp">void adaptive_sampling_rate() {
    // æ ¹æ®ç”µæ± ç”µé‡å’Œæ•°æ®éœ€æ±‚è°ƒæ•´é‡‡æ ·ç‡
    uint8_t battery_level = get_battery_level();

    if (battery_level &lt; 20) {
        // ä½ç”µé‡æ—¶é™ä½é‡‡æ ·ç‡
        reduce_sensor_sampling_rates();
    } else if (battery_level &gt; 80) {
        // ç”µé‡å……è¶³æ—¶æ¢å¤æ­£å¸¸é‡‡æ ·ç‡
        restore_sensor_sampling_rates();
    }
}
</code></pre>
<h2 id="%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%92%8C%E5%88%86%E6%9E%90">æ•°æ®å¤„ç†å’Œåˆ†æ</h2>
<h3 id="%E5%AE%9E%E6%97%B6%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86">å®æ—¶ä¿¡å·å¤„ç†</h3>

<pre class="language-cpp"><code class="language-cpp">// IMUæ•°æ®çš„è¿åŠ¨æ£€æµ‹
bool detect_motion(imu_data *data) {
    // è®¡ç®—åŠ é€Ÿåº¦å‘é‡çš„å¹…å€¼
    float accel_magnitude = sqrt(data-&gt;accel_x * data-&gt;accel_x +
                                data-&gt;accel_y * data-&gt;accel_y +
                                data-&gt;accel_z * data-&gt;accel_z);

    // åˆ¤æ–­æ˜¯å¦æœ‰æ˜¾è‘—è¿åŠ¨
    return (accel_magnitude &gt; MOTION_THRESHOLD);
}

// PPGæ•°æ®çš„å¿ƒç‡æ£€æµ‹
float calculate_heart_rate(ppg_sample *samples, int count) {
    // 1. ä¿¡å·é¢„å¤„ç†
    filter_ppg_signal(samples, count);

    // 2. å³°å€¼æ£€æµ‹
    int peak_count = detect_peaks(samples, count);

    // 3. å¿ƒç‡è®¡ç®—
    float sampling_period = 1.0f / PPG_SAMPLE_RATE;
    float heart_rate = (peak_count * 60.0f) / (count * sampling_period);

    return heart_rate;
}
</code></pre>
<h3 id="%E4%BC%A0%E6%84%9F%E5%99%A8%E8%9E%8D%E5%90%88">ä¼ æ„Ÿå™¨èåˆ</h3>

<pre class="language-cpp"><code class="language-cpp">// å¤šä¼ æ„Ÿå™¨èåˆçš„å§¿æ€ä¼°è®¡
void sensor_fusion_update(imu_data *imu, mag_data *mag) {
    // 1. åŠ é€Ÿåº¦è®¡å§¿æ€ä¼°è®¡
    float accel_roll = atan2(imu-&gt;accel_y, imu-&gt;accel_z);
    float accel_pitch = atan2(-imu-&gt;accel_x, 
                             sqrt(imu-&gt;accel_y * imu-&gt;accel_y + 
                                  imu-&gt;accel_z * imu-&gt;accel_z));

    // 2. é™€èºä»ªå§¿æ€ç§¯åˆ†
    integrate_gyroscope_data(imu);

    // 3. ç£åŠ›è®¡åèˆªè§’è®¡ç®—
    float mag_yaw = atan2(mag-&gt;mag_y, mag-&gt;mag_x);

    // 4. äº’è¡¥æ»¤æ³¢å™¨èåˆ
    complementary_filter_update(accel_roll, accel_pitch, mag_yaw);
}
</code></pre>
<h2 id="%E6%A0%A1%E5%87%86%E5%92%8C%E8%A1%A5%E5%81%BF">æ ¡å‡†å’Œè¡¥å¿</h2>
<h3 id="%E4%BC%A0%E6%84%9F%E5%99%A8%E6%A0%A1%E5%87%86">ä¼ æ„Ÿå™¨æ ¡å‡†</h3>

<pre class="language-cpp"><code class="language-cpp">// IMUé›¶åæ ¡å‡†
void calibrate_imu_bias() {
    const int calibration_samples = 1000;
    float accel_bias[3] = {0, 0, 0};
    float gyro_bias[3] = {0, 0, 0};

    // æ”¶é›†æ ¡å‡†æ•°æ®
    for (int i = 0; i &lt; calibration_samples; i++) {
        imu_data data;
        read_imu_data(&amp;data);

        accel_bias[0] += data.accel_x;
        accel_bias[1] += data.accel_y;
        accel_bias[2] += data.accel_z - 9.81f; // é‡åŠ›è¡¥å¿

        gyro_bias[0] += data.gyro_x;
        gyro_bias[1] += data.gyro_y;
        gyro_bias[2] += data.gyro_z;

        k_sleep(K_MSEC(1));
    }

    // è®¡ç®—å¹³å‡åå·®
    for (int i = 0; i &lt; 3; i++) {
        accel_bias[i] /= calibration_samples;
        gyro_bias[i] /= calibration_samples;
    }

    // å­˜å‚¨æ ¡å‡†å‚æ•°
    store_calibration_data(accel_bias, gyro_bias);
}
</code></pre>
<h3 id="%E6%B8%A9%E5%BA%A6%E8%A1%A5%E5%81%BF">æ¸©åº¦è¡¥å¿</h3>

<pre class="language-cpp"><code class="language-cpp">// PPGæ¸©åº¦è¡¥å¿
void temperature_compensation_ppg(ppg_sample *sample, float temperature) {
    // åŸºäºæ¸©åº¦çš„å¢ç›Šè¡¥å¿
    float temp_coeff = 1.0f + (temperature - 25.0f) * 0.001f;

    sample-&gt;red = (uint32_t)(sample-&gt;red * temp_coeff);
    sample-&gt;ir = (uint32_t)(sample-&gt;ir * temp_coeff);
    sample-&gt;green = (uint32_t)(sample-&gt;green * temp_coeff);
}
</code></pre>
<h2 id="%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9">é…ç½®é€‰é¡¹</h2>
<h3 id="Kconfig%E9%85%8D%E7%BD%AE">Kconfigé…ç½®</h3>

<pre class="language-kconfig"><code class="language-kconfig"># ä¼ æ„Ÿå™¨ç®¡ç†å™¨é…ç½®
CONFIG_SENSOR_WORK_QUEUE_STACK_SIZE=2048
CONFIG_SENSOR_WORK_QUEUE_PRIO=5
CONFIG_SENSOR_PUB_STACK_SIZE=1024
CONFIG_SENSOR_PUB_THREAD_PRIO=6

# ä¼ æ„Ÿå™¨ä½¿èƒ½
CONFIG_SENSOR_IMU=y
CONFIG_SENSOR_PPG=y
CONFIG_SENSOR_TEMPERATURE=y
CONFIG_SENSOR_BAROMETER=y
CONFIG_SENSOR_BONE_CONDUCTION=y

# é‡‡æ ·ç‡é…ç½®
CONFIG_IMU_DEFAULT_SAMPLE_RATE=100
CONFIG_PPG_DEFAULT_SAMPLE_RATE=400
CONFIG_TEMP_DEFAULT_SAMPLE_RATE=10

# æ•°æ®ç¼“å†²é…ç½®
CONFIG_SENSOR_QUEUE_SIZE=256
CONFIG_SENSOR_BUFFER_SIZE=64
</code></pre>
<h2 id="%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%92%8C%E8%AF%8A%E6%96%AD">é”™è¯¯å¤„ç†å’Œè¯Šæ–­</h2>
<h3 id="%E4%BC%A0%E6%84%9F%E5%99%A8%E5%81%A5%E5%BA%B7%E7%9B%91%E6%8E%A7">ä¼ æ„Ÿå™¨å¥åº·ç›‘æ§</h3>

<pre class="language-cpp"><code class="language-cpp">void sensor_health_check() {
    // æ£€æŸ¥å„ä¼ æ„Ÿå™¨çŠ¶æ€
    for (int id = 0; id &lt; NUM_SENSORS; id++) {
        EdgeMlSensor *sensor = get_sensor((sensor_id)id);

        if (sensor &amp;&amp; sensor-&gt;is_running()) {
            // æ£€æŸ¥æ•°æ®æ›´æ–°é¢‘ç‡
            if (sensor_data_rate[id] &lt; expected_rate[id] * 0.8f) {
                LOG_WRN(&quot;Sensor %d data rate low: %.1f Hz&quot;, 
                       id, sensor_data_rate[id]);

                // å°è¯•é‡å¯ä¼ æ„Ÿå™¨
                sensor-&gt;stop();
                k_sleep(K_MSEC(100));
                sensor-&gt;start(sensor_config[id].sample_rate_idx);
            }
        }
    }
}
</code></pre>
<h3 id="%E6%95%B0%E6%8D%AE%E8%B4%A8%E9%87%8F%E6%A3%80%E6%9F%A5">æ•°æ®è´¨é‡æ£€æŸ¥</h3>

<pre class="language-cpp"><code class="language-cpp">bool validate_sensor_data(struct sensor_data *data) {
    switch (data-&gt;id) {
        case ID_IMU:
            return validate_imu_data((imu_data*)data-&gt;data);
        case ID_PPG:
            return validate_ppg_data((ppg_sample*)data-&gt;data);
        case ID_TEMP_BARO:
            return validate_temp_baro_data((temp_baro_data*)data-&gt;data);
        default:
            return true;
    }
}
</code></pre>
<h2 id="%E6%80%BB%E7%BB%93">æ€»ç»“</h2>
<p>ä¼ æ„Ÿå™¨ç®¡ç†æ¨¡å—æ˜¯OpenEarable 2.0çš„æ ¸å¿ƒåˆ›æ–°ç‰¹æ€§ï¼Œå…·æœ‰ä»¥ä¸‹å…³é”®ä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>å¤šä¼ æ„Ÿå™¨é›†æˆ</strong>: æ”¯æŒIMUã€PPGã€æ¸©åº¦ã€æ°”å‹ç­‰å¤šç§ä¼ æ„Ÿå™¨</li>
<li><strong>ç»Ÿä¸€ç®¡ç†æ¥å£</strong>: é€šè¿‡EdgeMLSensoråŸºç±»æä¾›ç»Ÿä¸€çš„ä¼ æ„Ÿå™¨æ¥å£</li>
<li><strong>é«˜æ•ˆæ•°æ®æµ</strong>: åŸºäºæ¶ˆæ¯é˜Ÿåˆ—å’ŒZBusçš„é«˜æ•ˆæ•°æ®ä¼ è¾“</li>
<li><strong>çµæ´»é…ç½®</strong>: æ”¯æŒåŠ¨æ€é…ç½®é‡‡æ ·ç‡å’Œå­˜å‚¨é€‰é¡¹</li>
<li><strong>å®æ—¶å¤„ç†</strong>: ä½å»¶è¿Ÿçš„æ•°æ®é‡‡é›†å’Œå¤„ç†èƒ½åŠ›</li>
<li><strong>åŠŸè€—ä¼˜åŒ–</strong>: æ™ºèƒ½çš„åŠŸè€—ç®¡ç†å’Œè‡ªé€‚åº”é‡‡æ ·</li>
<li><strong>æ•°æ®è´¨é‡</strong>: å®Œå–„çš„æ ¡å‡†ã€è¡¥å¿å’Œè´¨é‡æ£€æŸ¥æœºåˆ¶</li>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>: æ˜“äºæ‰©å±•æ–°çš„ä¼ æ„Ÿå™¨ç±»å‹</li>
</ol>
<p>è¯¥æ¨¡å—ä¸ºOpenEarable 2.0æä¾›äº†å¼ºå¤§çš„ä¼ æ„Ÿå™¨æ•°æ®é‡‡é›†å’Œå¤„ç†èƒ½åŠ›ï¼Œæ”¯æŒå„ç§ç”Ÿç†ç›‘æµ‹ã€è¿åŠ¨è¿½è¸ªå’Œç¯å¢ƒæ„ŸçŸ¥åº”ç”¨ï¼Œæ˜¯å®ç°æ™ºèƒ½è€³æˆ´å¼è®¾å¤‡åŠŸèƒ½çš„æ ¸å¿ƒåŸºç¡€ã€‚</p>

                        
                    </div>
                </div>
                <div id="previous_next">
                    <div id="previous">
                        
                        <a href="/lhfdoc.github.io/embedded_dev/openearable/audio-module.html">
                            <span class="icon"></span>
                            <span class="label">ğŸµ éŸ³é¢‘å¤„ç†æ¨¡å—</span>
                        </a>
                        
                    </div>
                    <div id="next">
                        
                        <a href="/lhfdoc.github.io/embedded_dev/openearable/bluetooth-module.html">
                            <span class="label">ğŸ“¶ è“ç‰™é€šä¿¡æ¨¡å—</span>
                            <span class="icon"></span>
                        </a>
                        
                    </div>
                </div>
                <div id="comments-container"></div>
            </div>
            <div id="toc_wrapper">
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="to_top" href="#"></a>
    <div id="doc_footer">
        <div id="footer">
            <div id="footer_top">
                <ul>
<li><a>ç›¸å…³èµ„æº</a><ul><li><a target="_blank" href="https://www.nordicsemi.com/">Nordicå®˜ç½‘</a></li>
<li><a target="_blank" href="https://zephyrproject.org/">Zephyré¡¹ç›®</a></li>
</ul>
</li>
</ul>

            </div>
            <div id="footer_bottom">
                <ul>
</ul>

            </div>
        </div>
    </div>
    
        <script src="/lhfdoc.github.io/teedoc-plugin-markdown-parser/mermaid.min.js"></script>
    
        <script>mermaid.initialize({startOnLoad:true});</script>
    
        <script src="/lhfdoc.github.io/static/js/theme_default/tocbot.min.js"></script>
    
        <script src="/lhfdoc.github.io/static/js/theme_default/main.js"></script>
    
        <script src="/lhfdoc.github.io/static/js/theme_default/viewer.min.js"></script>
    
        <script src="/lhfdoc.github.io/static/css/theme_default/prism.min.js"></script>
    
        <script src="/lhfdoc.github.io/static/js/search/search_main.js"></script>
    
        <script src="/lhfdoc.github.io/static/js/custom.js"></script>
    
</body>

</html>